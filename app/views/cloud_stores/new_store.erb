<% content_for :content_settings do %>
<% provide(:title, 'Services') %>
<%= render :partial => "users/header" , :locals => {:head => "Services - Step 2 of 2"}%>
<div id="breadcrumb">
	<%= render_breadcrumbs %>
</div>
<div class="container-fluid">
	<div class="row">
		<% if @db_model == "multitenant" %>
		<div class="alert alert-info alert-block">
			<h4 class="alert-heading">Go Ahead Select "Full" </h4>
			<div>
				<p class="help-block"></p>
				<i class="icon-chevron-down"></i>&nbsp; &nbsp; We working on it.
				</br>
			</div>
			<a class="close" data-dismiss="alert alert-warning" href="#">×</a>
		</div>
		<% else %>

		<%= form_for @book, :html => {:multipart => true }, :remote => true, :method => 'post' do |f| %>

		<!--<div class="widget-box">
		<div class="widget-title">
		<span class="icon"> <i class="icon-th-list"></i> </span>
		<h5>Cloud Store Selected</h5>
		</div>
		<div class="widget-content">
		<div class="control-group">
		<div class="controls">
		<div class="row">
		<div class="col-md-12">
		<p class="help-block">
		<strong><span class="label label-info">Store launch</span> How does it happen ? </strong>
		<%= link_to " For more information",   "http://docs.megam.co", { :target => '_blank'} %>
		</p>
		</div>
		</div>
		<div class="row">
		<div class="col-md-3">
		<i class="logo_chef"></i>
		</div>
		<div class="col-md-2">
		<h3>Will Launch<h3><span class="badge badge-info"> <h4>Role : <%= @predef.provider_role %><h4></span>
		</div>
		<div class="col-md-2">
		<h3 align="center"><i class="i_cloud"></i></h3>
		</div>
		<div class="col-md-2">
		<%= image_tag "build_monkey.png", :alt => "build bots" %>
		</div>
		<div class="col-md-3">
		<h3>Build monkey<h3><span class="badge badge-success"><h4> <%= @predef.build_monkey %></h4></span>
		</div>
		</div>

		</div>
		</div>
		</div>
		</div>-->
	</div>
	<div class="row"  ng-controller="CloudBooksCtrl">
		<% @new_book_name = book_name %>
		<div class="widget-box">
			<div class="widget-title">
				<span class="icon"> <i class="icon-th-list"></i> </span>
				<h5>Service Name</h5>
			</div>
			<div class="widget-content">
				<div class="col-md-12">
					<p class="help-block">
						Your current service launch URL
					</p>
				</div>
				</br>
				<div class="col-md-12">
					<div class="col-md-7">
						<a class="btn btn-lg btn-primary disabled btn-block" data-name="book_name" data-type="text" href="#" id="identity_new" ><%= @new_book_name %></a>
					</div>
					<div class = "col-md-4">
						<%= link_to  @domain_name, "#", :class => "btn btn-lg btn-primary disabled btn-block", :id => 'domain'%>
					</div>
				</div>
				<br/>
				<br/>
				<br/>

				<%= f.text_field :name, :type => 'hidden', :id=> 'changename', :value => @new_book_name %>
				<input type="hidden" name="book_name" id="bookname" value="<%= @new_book_name %>">
				<%= f.text_field :domain_name, :type => 'hidden', :value => @domain_name %>
			</div>
		</div>
	</div>
	<div class="col-xs-12 col-sm-12">
		<div class="widget-box">
			<div class="widget-title">
				<span class="icon"> <i class="icon-th-list"></i> </span>
				<h5>Cloud Selection</h5>
			</div>
			<div class="widget-content">
				<div class="row">
					<div class="control-group">
						<p class="help-block">
							Choose a cloud.
							<%= link_to "To learn more about attaching a new cloud account",   "http://docs.megam.co", { :target => '_blank'} %>
						</p>
						<p>
							<%= f.select :predef_cloud_name, options_for_select(@predef_cloud.map{ |c| [c.name] }) %>
						</p>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="widget-box">
			<div class="widget-title">
				<span class="icon"> <i class="icon-th-list"></i> </span>
				<h5>Cloud Selection</h5>
			</div>
			<div class="widget-content">
				<div class="control-group">
					<p class="help-block">
						<strong><span class="label label-info">Default</span> Cloud. You can create your own.</strong>
						<%= link_to "For more information",   "http://docs.megam.co", { :target => '_blank'} %>
					</p>
					<p>
						<%= f.select :predef_cloud_name, options_for_select(@predef_cloud.map{ |c| [c.name] }) %>
					</p>
				</div>
			</div>
		</div>
	</div>
	<% @predef_hash = {} %>
	<% @predef_cloud.each do |k| %>
	<% @predef_hash = @predef_hash.merge(@predef) %>
	<% end %>

	<% @predef_hash.each do |key,value| %>
	<%= hidden_field_tag "predef[#{key}]",value %>

	<% end %>

	<%= f.text_field :predef_name, :type => 'hidden', :value => @predef_name %>
	<%= f.text_field :book_type, :type => 'hidden', :value => "BOLT" %>
	<input type="hidden" name="no_of_instances" value="<%= @no_of_instances %>">
	<div class="row">
		<div class="widget-box">
			<div class="widget-title">
				<span class="icon"> <i class="icon-th-list"></i> </span>
				<h5>Advanced Service Settings</h5>
			</div>
			<div class="widget-content">
				<div class="input-group">
					<span class="input-group-addon">Service Name</span>
					<%= text_field_tag 'store_db_name', "db_#{current_user.first_name}", :readonly => true %>
				</div>
				<% if @dbms == 'postgresql' %>
				<div class="input-group">
					<span class="input-group-addon">Service Username</span>
					<%= text_field_tag 'user_name', "#{current_user.first_name}", :readonly => true %>
				</div>
				<div class="input-group">
					<span class="input-group-addon">Service password</span>
					<%= text_field_tag 'password', "#{current_user.api_token}", :readonly => true %>
				</div>
				<div class="input-group">
					<span class="input-group-addon">Service url</span>
					<%= text_field_tag 'url', "postgres://#{current_user.first_name}:#{current_user.api_token}@postgres1.megam.co.in:5432/db_#{current_user.first_name}", :readonly => true %>
				</div>
				<div class="input-group">
					<span class="input-group-addon">Service Initiation Commands</span>
					<%= text_area_tag 'prime', nil, placeholder: "Enter prime" %>
				</div>
				<% end %>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="col-md-4"></div>
		<div class="col-md-4">
			<%= f.submit "Create Service", :class => "btn btn-lg btn-success btn-block" %>
			<br/>
			</br/>
			<% end %>
			<% end %>
		</div>
		<div class="span4"></div>

	</div>

	<div id="cloudbook_postfinish_popup" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
						×
					</button>
					<h3 id="myModalLabel">Service</h3>
				</div>
				<div class="modal-body">
					<div class="alert">

						<p>
							<h4> A Service creation request to the megam cloud gateway was successful. </h4>
							</br>
							<strong>Click<span class="label label-info"> OK </span> to watch the status Real Time</strong>
						</p>
					</div>
				</div>
				<div class="modal-footer" id="history_path">
					<%= link_to  "Ok", cloud_stores_path, :class => "btn btn-sm btn-primary", :target => "_self" %>
				</div>
			</div>
		</div>
	</div>

	<div id="cloudbook_postfinish_popup_error" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
						×
					</button>
					<h3 id="myModalLabel">Service</h3>
				</div>
				<div class="modal-body">
					<div class="alert">

						<p>
							<h4> A Service creation request to the megam cloud gateway was not successful. </h4>
							</br>
							<div id="err_msg"></div>
						</p>
					</div>
				</div>
				<div class="modal-footer">
					<%= link_to  "Ok", cloud_stores_path, :class => "btn btn-sm btn-primary", :target => "_self" %>
				</div>
			</div>
		</div>
	</div>

</div>
<% end %>
<%= render :template => users_show_path %>
