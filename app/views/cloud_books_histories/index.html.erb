<% content_for :content_settings do %>
<% provide(:title, 'cloud_book_history') %>
<%= render :partial => "contents/header" , :locals => {:head => "Cloud Book Histories"}%>
<div id="breadcrumb">
	<%= render_breadcrumbs %>
</div>
	<div ng-controller="MyCtrl">
		<div class="container-fluid">
			<div class="widget-box">
				<div class="widget-title">
					<span class="icon"> <i class="icon-th-list"></i> </span>
					<h5>Cloud Books Run History</h5>
				</div>
				<div class="widget-content nopadding" style="height: 200px;  overflow-y: scroll;">
					<table class="table table-bordered table-striped table-hover">
						<thead>
							<tr>
								<th>book_name</th>
								<th>request_id</th>
								<th>status</th>
							</tr>
						</thead>
						<tbody>
							<% current_user.cloud_books.each do |cloud_book| %>
							<% cloud_book.cloud_books_histories.each do |history| %>
							<tr>
								<td>
								<input type="button" ng-model="query" ng-click="sendmessage('<%= history.book_name %>')" id="node_names" value="<%= history.book_name %>">
								</td>
								<td> <%= history.request_id %> </td>
								<td> <%= history.status %> </td>
							</tr>
							<% end %>
							<% end %>
						</tbody>
					</table>
				</div>
			</div>
			<input type="hidden" ng-model="source">
			<div class="widget-box">
				<div class="widget-title">
					<span class="icon"> <i class="icon-th-list"></i> </span>
					<h5>Watch Realtime Log</h5>
					<span class="label label-info">{{source}}</span>
				</div>
				<div class="widget-content nopadding" style="height: 250px;  overflow-y: scroll;">
					<table class="table table-bordered table-striped table-hover">
						<thead>
							<tr>
								<th class="span3">Timestamp</th>
								<th class="span9">Message</th>
							</tr>
						</thead>
						<tbody>
							<tr ng-repeat="log in logs | orderBy:predicate:!reverse | filter:filterLog">
								<td>
								<p>
									{{ log.timestamp | date:'d  MMMM,  y - hh:mm a Z' }}
								</p></td>
								<td>
								<p>
									{{ log.message }}
								</p></td>
							</tr>
						</tbody>
					</table>
				</div>			
		</div>
	</div>
</div>
<% end %>
<%= render :template => users_show_path %>
