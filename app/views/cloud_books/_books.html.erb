<div class="container-fluid">
	<div class="row-fluid">
		<div class="span10">
			<div class="widget-box">
				<div class="widget-title">
					<span class="icon"> <i class="fa fa-th-list"></i> </span>
					<h5>Your Usage</h5>
				</div>
				<div class="widget-content" >
					<div class="row-fluid">
						<div class="span4">
							<div class="cb_box">
								<h4 align="center"> Quota</h4><h3 align="center" ><span class="icon"><i class="fa fa-book"></i></span>&nbsp;<%= @cb_count %>&nbsp; of 2</h3> <% @percent = @cb_count/2.0*100 %>
							</div>
							<% if @percent >= 80 %>
							</br>
							<div class="progress progress-danger">
								<div class="bar" style="width: <%= @percent %>%;"></div>
							</div>
							<% else %>
							<br/>
							<div class="progress progress-success">
								<div class="bar" style="width: <%= @percent %>%;"></div>
							</div>
							<% end %>
						</div>

						<div class="span4">
							<span class="btn btn-large disabled btn-block"><h3><%= @cb_count %></h3> <h4>Launched </h4> </span>
							</br>
							<a href="http://support.megam.co/kb/cloud-applications/"><i class="fa fa-question-sign"> We are here to help </i> </a>
						</div>
						<div class="span4">
							<div class="cb_box">
								<h4 align="center" >Recent Activity</h4><h5 align="Center"><span class="icon"> <i class="fa fa-calendar"></i> </span><b><%= latest_book.created_at.to_formatted_s(:rfc822) %></b></h5> <% @n_hash.select{|k, v|k==latest_book.name}.each do |k, v| %>
								<% v.each do |node| %>
								<% cloud_book = @nodes.lookup(node) %> <h5 align="Center"> <%= link_to "#{cloud_book.node_name}", cloud_book_path(:id => latest_book.id, :name => cloud_book.node_name, :book_type => cloud_book.node_type), :remote => true, data: { spinlock: '#book'} %> </h5> <% end %>
								<% end %>
							</div>
						</div>
					</div>
					<div class="row-fluid">
						<div class="span4">
							<%= link_to "GoTo Run History", cloud_books_histories_path, class: "btn btn-large btn-success btn-block", :target => "_self" %>
						</div>
						<div class="span4">
							<%= link_to "Create", new_cloud_book_path, class: "btn btn-large btn-success btn-block", :target => "_self" %>
						</div>
						<div class="span4">
							<%= link_to "Upgrade", pricing_path, class: "btn btn-large btn-inverse btn-block ", :target => "_self" %>
						</div>
					</div>

				</div>
			</div>
		</div>
	</div>
	<div class="row-fluid">
		<div class="span10">
			<div class="widget-box">
				<div class="widget-title">
					<span class="icon"> <i class="fa fa-th-list"></i> </span>
					<h5>Your Usage</h5>
				</div>
				<div class="widget-content">
					<% @n_hash.each do |k, v| %>
					<% cb = CloudBook.find_by_name(k) %>
					<div class="accordion" id="collapse-group">
						<div class="accordion-group widget-box">
							<div class="accordion-heading">
								<div class="widget-title">
									<a data-parent="#collapse-group" href="#collapse<%= k%>" data-toggle="collapse"> <span class="icon"> <i class="fa fa-magnet"></i></span> <% if cb.book_type == 'APP' %> <span class="label label-info"> <%= cb.book_type %> </span> <% elsif cb.book_type == 'BOLT' %> <span class="label label-warning"><%= cb.book_type %></span> <% end %> </a>
									<p></p>
									<span class="badge badge-info"><%= k%></span>
								</div>
							</div>
							<div class="collapse accordion-body" id="collapse<%= k%>">
								<div class="widget-content nopadding"  style="overflow-y: scroll; height:250px;">
									<table class="table table-bordered table-striped table-hover">
										<thead>
											<tr>
												<th>Actions</th>
												<th>Name</th>
												<th>Clone</th>
												<th>Destroy</th>
												<th>Created At</th>
												<th>Status</th>
											</tr>
										</thead>
										<tbody>
											<% v.each do |node| %>

											<tr>
												<% cloud_book = @nodes.lookup(node) %>
												<td> <% if cloud_book.node_type == "APP" %>
												<div class="btn-group">
													<a class="btn dropdown-toggle" data-toggle="dropdown" href="#"> Actions <span class="caret"></span> </a>
													<ul class="dropdown-menu">
														<li>
															<%= link_to "Build App", build_request_path(:name => cloud_book.node_name, :defnsid => cloud_book.appdefnsid, :req => "build"), :remote => true %>
														</li>
														<li class="divider"></li>
														<li>
															<%= link_to "Start App", build_request_path(:name => cloud_book.node_name, :defnsid => cloud_book.appdefnsid, :req => "start"), :remote => true %>
														</li>
														<li>
															<%= link_to "Stop App", build_request_path(:name => cloud_book.node_name, :defnsid => cloud_book.appdefnsid, :req => "stop"), :remote => true %>
														</li>
														<li>
															<%= link_to "Restart App", build_request_path(:name => cloud_book.node_name, :defnsid => cloud_book.appdefnsid, :req => "restart"), :remote => true %>
														</li>
														<li class="divider"></li>
														<li>
															<%= link_to "More", cloud_book_path(:id => cb.id, :name => cloud_book.node_name, :book_type => cloud_book.node_type), :remote => true, data: { spinlock: '#book'} %>
														</li>
													</ul>
												</div> <% else %>
												<div class="btn-group">
													<a class="btn dropdown-toggle" data-toggle="dropdown" href="#"> Actions <span class="caret"></span> </a>
													<ul class="dropdown-menu">
														<li>
															<%= link_to "Start Bolt", build_request_path(:name => cloud_book.node_name, :defnsid => cloud_book.boltdefnsid, :req => "start"), :remote => true %>
														</li>
														<li>
															<%= link_to "Stop Bolt", build_request_path(:name => cloud_book.node_name, :defnsid => cloud_book.boltdefnsid, :req => "stop"), :remote => true %>
														</li>
														<li>
															<%= link_to "Restart Bolt", build_request_path(:name => cloud_book.node_name, :defnsid => cloud_book.boltdefnsid, :req => "restart"), :remote => true %>
														</li>
														<li class="divider"></li>
														<li>
															<%= link_to "Backup Bolt", build_request_path(:name => cloud_book.node_name, :defnsid => cloud_book.boltdefnsid, :req => "build"), :remote => true %>
														</li>
														<li>
															<%= link_to "More", cloud_book_path(:id => cb.id, :name => cloud_book.node_name, :book_type => cloud_book.node_type), :remote => true, data: { spinlock: '#book'} %>
														</li>
													</ul>
												</div> <% end %> </td>
												<td> <%= link_to "#{cloud_book.node_name}", "http://#{cloud_book.node_name}" , { :target => '_blank'} %> </td>
												<td> <%= link_to clone_build_path(:name => cloud_book.node_name), :class =>"btn btn-mini btn-success", :title=> "CLone Cloud Book", :remote => true, method: :post do %> <i class="fa fa-plus-sign"> Clone</i> <% end %> </td>
												<td> <%= link_to cloud_book_path(:id => cb.id, :name => cloud_book.node_name, :n_hash => @n_hash), :class =>"btn btn-mini btn-danger", :title=> "Delete Cloud Book", method: :delete, :remote => true, :target => "_self", :data => { :confirm => "Are you sure?", spinner: '#delete_node'} do %> <i class="fa fa-trash"> Delete</i> <% end %>  <%= mini_spinner_tag 'delete_node' %> </td>
												<td><span class="icon"> <i class="fa fa-calendar"></i> </span> <%= cloud_book.created_at.to_datetime.to_formatted_s(:rfc822) %> </td>

												<!--<td> <%= link_to "delete", cloud_book_path(:id => cb.id, :name => cloud_book.node_name, :n_hash => @n_hash), method: :delete, class: "btn btn-mini btn-success", :data => { :confirm => "Are you sure?"}%></td>-->
												<td> <%= cloud_book.status %> </td>

											</tr>

											<% end %>
										</tbody>

									</table>

								</div>
							</div>
						</div>
					</div>
					<% end %>
				</div>
			</div>
		</div>
	</div>
	<div class="row-fluid">
		<div class="span10" >
			<div  id="cb_action"></div>
		</div>

	</div>

</div>
<!-- container-fluid -->

<div id="cloudbook_request_popup" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">

	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
			Ã—
		</button>
		<h3 id="myModalLabel">Cloud Book</h3>
	</div>
	<div class="modal-body">
		<div class="info">
			<%= form_tag(send_request_path, :method => "post") do %>
			<input type="hidden" id="req_type_pop" name="req_type" value="">
			<input type="hidden" id="node_name_pop" name="node_name" value="">
			<input type="hidden" id="defns_id_pop" name="defns_id" value="">

			sample value : apache STOP - explanation maybe: When to apply (lc_apply) something in the lifecycle of an app or a bolt if apache is started. lc stands for lifecycle.
			<%= text_field_tag 'lc_apply', nil, placeholder: 'Modify runtime exec - script', hint: "test" %>
			<br/>
			<%= text_field_tag 'lc_additional', nil, placeholder: 'Modify addtional runtime - script' %>
			<br/>
			<%= text_field_tag 'lc_when', nil, placeholder: 'Modify when to apply - script' %>
		</div>
	</div>
	<div class="modal-footer">
		<%= link_to send_request_path(:defns_id => "deff",:req_type => "app_r_bolt"), :class =>"btn btn-success btn-block", :remote => true, :target => "_self", :data => { spinner: '#req_node'} do %> <i class="fa fa-trash"> Request Node</i> <% end %>
		<%= mini_spinner_tag 'req_node' %>
		<% end %>
	</div>
	<%= spinner_tag 'spin_req' %>
</div>
