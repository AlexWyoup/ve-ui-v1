<% content_for :content_settings do %>
<% provide(:title, 'cloud_books') %>
<%= render :partial => "users/header" , :locals => {:head => "Cloud Platform - Step 2 of 2"}%>
<div id="breadcrumb">
	<%= render_breadcrumbs %>
</div>
<div class="container-fluid">

	<%= form_for @book, :html => {:multipart => true }, :remote => true, :method => 'post' do |f| %>

	<div class="widget-box">
		<div class="widget-title">
			<span class="icon"> <i class="icon-th-list"></i> </span>
			<h5>Platform Selected</h5>
		</div>
		<div class="widget-content">
			<div class="control-group">
				<div class="controls">
					<div class="row-fluid">
						<div class="span12">
							<p class="help-block">
								<strong><span class="label label-info">Platform launch</span> How does it happen ? For more information</strong>
								<%= link_to "Platform launch",   "http://docs.megam.co", { :target => '_blank'} %>
							</p>
						</div>
					</div>
					<div class="row-fluid">
						<div class="span3">
							<i class="logo_chef"></i>
						</div>
						<div class="span2">
							<h3>Will Launch<h3><span class="badge badge-info"> <h4>Role : <%= @predef.provider_role %><h4></span>
						</div>
						<div class="span2">
							<h3 align="center"><i class="i_cloud"></i></h3>
						</div>
						<div class="span2">
							<%= image_tag "build_monkey.png", :alt => "build bots" %>
						</div>
						<div class="span3">
							<h3>Build monkey<h3><span class="badge badge-success"><h4> <%= @predef.build_monkey %></h4></span>
						</div>
					</div>

				</div>
			</div>
		</div>
	</div>
	<div class="row-fluid"  ng-controller="CloudBooksCtrl">
		<div class="span12">
			<% @new_book_name = book_name %>
			<div class="widget-box">
				<div class="widget-title">
					<span class="icon"> <i class="icon-th-list"></i> </span>
					<h5>Cloud Book Name</h5>
				</div>
				<div class="widget-content">
					<p class="help-block">
						<strong><span class="label label-warning">*optional</span> Click on the default book name to change it</strong>
					</p>
					</br>
					<div class="span12">
						<div class="span7">

							<!--<%= link_to  @new_book_name, "#", :id => "identity_new", :onchange => "angular.element(this).scope().fileNameChaged()", :class => "btn btn-large btn-primary disabled btn-block", :data => { :type => 'text', :name => 'book_name'} %>-->
							<a class="btn btn-large btn-primary disabled btn-block" data-name="book_name" data-type="text" href="#" id="identity_new" ><%= @new_book_name %></a>
						</div>
						<div class = "span4">
							<%= link_to  @domain_name, "#", :class => "btn btn-large btn-primary disabled btn-block", :id => 'domain'%>
						</div>
					</div>
					<br/>
					<br/>
					<br/>

					<%= f.text_field :name, :type => 'hidden', :id=> 'changename', :value => @new_book_name %>
					<%= f.text_field :domain_name, :type => 'hidden', :value => @domain_name %>
				</div>
			</div>
		</div>
	</div>

	<div class="widget-box">
		<div class="widget-title">
			<span class="icon"> <i class="icon-th-list"></i> </span>
			<h5>Cross Cloud Selection</h5>
		</div>
		<div class="widget-content">
			<div class="control-group">
				<p class="help-block">
					<strong><span class="label label-info">Default</span> Cross cloud default. Upgrade to create more.</strong>
					<%= link_to "Cross Cloud Settings",   "http://docs.megam.co", { :target => '_blank'} %>
				</p>
				<p>
					<%= f.select :predef_cloud_name, options_for_select(@predef_cloud.map{ |c| [c.name] }) %>
				</p>
			</div>
		</div>
	</div>

	<div class="widget-box">
		<div class="widget-title">
			<span class="icon"> <i class="icon-th-list"></i> </span>
			<h5>Application Definitions</h5><strong><span class="label label-info"><%= current_user.user_type %> user</span> </strong>
		</div>
		<div class="widget-content">
			<div class="control-group">
				<p class="help-block">
					<strong><span class="label label-info">Default</span> Application Definition default. Read about app_defns.</strong>
					<%= link_to "Application Definition",   "http://docs.megam.co", { :target => '_blank'} %>
				</p>
				<table class="table table-bordered table-hover">
					<thead></thead>
					<tbody>
						<tr>
							<div class="row-fluid">
								<div class="span12">
									<div class="span1">
										<h3 align="center"><i class="i_chart"></i></h3>
									</div>
									<div class="span4">
										<span> Want us to monitor ?</span>
									</div>
									<div class = "span3">
										<div class="back" id="toggle">
											<br/>
											<%= hidden_field_tag 'monitoring', "" %>
											<%= check_box_tag 'monitoring', "megam" %>
											<%= label_tag :monitoring %>
										</div>
									</div>
									<div class = "span4">

									</div>
								</div>
							</div>
						</tr>
						<tr>
							<div class="row-fluid">
								<div class="span12">
									<div class="span1">
										<h3 align="center"><i class="icon-download-alt"></i></h3>
									</div>
									<div class="span4">
										<span>Want us to stream logs ?</span>
									</div>
									<div class = "span3">
										<div class="back" id="toggle">
											<br/>
											<label for="enjoy_web"></label>
											<%= hidden_field_tag 'logging', "" %>
											<%= check_box_tag 'logging', "megam" %>
											<%= label_tag :logging %>
										</div>
									</div>
									<div class = "span4">

									</div>
								</div>
							</div>
						</tr>
						<tr>
							<div class="row-fluid">
								<div class="span12">
									<div class="span1">
										<h3 align="center"><i class="icon-edit"></i></h3>
									</div>
									<div class="span4">
										<span class="label label-warning"> *optional</span>
										<span> Wish to change default start script </span>
									</div>
									<div class="span7">
										<%= text_field_tag 'runtime_exec', "#{@predef.runtime_exec}", placeholder: 'Modify runtime exec - script' %>
									</div>
								</div>
							</div>
						</tr>
						<tr>
							<div class="row-fluid">
								<div class="span12">
									<div class="span1">
										<h3 align="center"><i class="icon-fire"></i></h3>
									</div>
									<div class="span4">
									<span class="label label-warning"> *free accounts - instances run for a day</span>	<span>Your Start Time</span>

									</div>
									<div class="span7">
										<%= text_field_tag 'tometokill', "#{Time.now.to_formatted_s(:rfc822)}", :readonly => true %>
									</div>
								</div>
							</div>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>

	<% @predef_hash = {} %>
	<% @predef_cloud.each do |k| %>
	<% @predef_hash = @predef_hash.merge(@predef) %>
	<% end %>

	<% @predef_hash.each do |key,value| %>
	<%= hidden_field_tag "predef[#{key}]",value %>

	<% end %>

	<%= f.text_field :predef_name, :type => 'hidden', :value => @predef_name %>
	<%= f.text_field :book_type, :type => 'hidden', :value => "APP" %>
	<input type="hidden" name="no_of_instances" value="<%= @no_of_instances %>">
	<input type="hidden" name='deps_scm' value="<%= @deps_scm %>">
	<input type="hidden" name="deps_war" value="<%= @deps_war %>">
	
	<div class="row-fluid">
		<div class="span4"></div>
		<div class="span4 container-fluid">
			<%= f.submit nil, :class => "btn btn-large btn-success btn-block", :data =>
			{:disable_with => "Creating Book..."} %>
			<% end %>
		</div>
		<div class="span4"></div>

	</div>

	<div id="cloudbook_postfinish_popup" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">

		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
				×
			</button>
			<h3 id="myModalLabel">Cloud Book</h3>
		</div>
		<div class="modal-body">
			<div class="alert alert-success">

				<p>
					A cloud book creation request to the megam cloud server was successful.
					</br>
					<strong>Click<span class="label label-info"> OK </span> to watch the status Real Time</strong>
				</p>
			</div>
		</div>
		<div class="modal-footer">
		<%= link_to  "Ok", cloud_books_path, :class => "btn btn-primary", :target => "_self" %>
		</div>
	</div>

	<div id="cloudbook_postfinish_popup_error" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">

		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
				×
			</button>
			<h3 id="myModalLabel">Cloud Book</h3>
		</div>
		<div class="modal-body">
			<div class="alert alert-error">

				<p>
					A cloud book creation request to the megam cloud server was not successful.
					</br>
					<div id="err_msg"></div>
				</p>
			</div>
		</div>
		<div class="modal-footer">
			<%= link_to  "Ok", new_cloud_book_path, :class => "btn btn-primary", :target => "_self" %>
		</div>
	</div>

</div>
<% end %>
<%= render :template => users_show_path %>
